<core:View xmlns:u="sap.ui.unified" xmlns:core="sap.ui.core" xmlns:f="sap.ui.layout.form" xmlns:html="http://www.w3.org/1999/xhtml" xmlns:l="sap.ui.layout" xmlns:t="sap.ui.table" xmlns="sap.m" controllerName="controller.VendaVarejo">
<Page visible="{ path: 'Caixa>/aberto', formatter: '.formatterCaixaAberto' }" showFooter="true" showHeader="false">
<content>
<f:SimpleForm editable="true" layout="ResponsiveGridLayout" labelSpanL="4" columnsL="3" columnsM="2">
<f:content>
<core:Title text="Cliente"/>
<Label text="Código"/>
<l:VerticalLayout>
<Input id="idNovaVendaClienteInput" enabled="{NovaVenda>/memorizado}" placeholder="Selecionar Cliente" showValueHelp="true" valueHelpRequest="onInputHelpClientesRequest" selectedKey="{NovaVenda>/sClientes/id}" showTableSuggestionValueHelp="true" showSuggestion="true" suggestionItems="{InputHelpClientes>/}" suggest="onSuggetsClients">
<suggestionItems>
<core:ListItem key="{InputHelpClientes>id}" text="{InputHelpClientes>id}" additionalText="{InputHelpClientes>nome} - {InputHelpClientes>cpf}{InputHelpClientes>cnpj}"/>
</suggestionItems>
</Input>
<l:HorizontalLayout>
<Button enabled="{ path: 'NovaVenda>/sClientes/id', formatter: '.formatterEnableEditCliente' }" icon="sap-icon://edit" press="onEditCliente"/>
<Button id="btnCreateCliente" icon="sap-icon://document" press="onCreateCliente"/>
</l:HorizontalLayout>
</l:VerticalLayout>
<Label text="Nome"/>
<Text id="idTextNomeCliente" text="{NovaVenda>/sClientes/nome}"/>
<Label text="CPF/CNPJ"/>
<Text text="{NovaVenda>/sClientes/cpf}{NovaVenda>/sClientes/cnpj}"/>
<Label text="Status ver. Crédito"/>
<Text text="{NovaVenda>/sClientes/statusCredito}"/>
<core:Title text="Venda" id="IdTituloPagina"/>
<Label text="Vendedor"/>
<Select enabled="{ path: 'NovaVenda>/sClientes/id', formatter: '.formatterEnableEditCliente' }" forceSelection="false" selectedKey="{NovaVenda>/idVendedores}" items="{InputHelpVendedores>/}" change="onVendedoresChange">
<core:Item key="{InputHelpVendedores>id}" text="{InputHelpVendedores>nome}"/>
</Select>
<Label text="Tipo de Venda"/>
<Select enabled="false" selectedKey="{NovaVenda>/idTiposVenda}" items="{InputHelpTiposVenda>/}" change="onTiposVendaChange">
<core:Item key="{InputHelpTiposVenda>id}" text="{InputHelpTiposVenda>id} - {InputHelpTiposVenda>descricao}"/>
</Select>
<Label text="Tipo de Frete"/>
<Select enabled="{ path: 'NovaVenda>/sClientes/id', formatter: '.formatterEnableEditCliente' }" selectedKey="{NovaVenda>/idTiposFrete}" items="{InputHelpTiposFrete>/}" change="onTiposFreteChange">
<core:Item key="{InputHelpTiposFrete>id}" text="{InputHelpTiposFrete>id} - {InputHelpTiposFrete>descricao}"/>
</Select>
<core:Title text="Informações Adicionais"/>
<TextArea enabled="{ path: 'NovaVenda>/sClientes/id', formatter: '.formatterEnableEditCliente' }" value="{NovaVenda>/infoAdicional}" id="textInfoAdicionais" rows="4" wrapping="None" change="onInformacoesAdicionaisChange"/>
</f:content>
</f:SimpleForm>
<ScrollContainer focusable="true" horizontal="true" class="sapUiContentPadding">
<t:Table id="tableItens" rows="{NovaVenda>/tItens/}" selectionMode="None" visibleRowCount="15">
<t:toolbar>
<Toolbar>
<Title text="Produtos" width="10em"/>
<ToolbarSpacer/>
<Input visible="{NovaVenda>/memorizado}" enabled="{ path: 'NovaVenda>/sClientes/id', formatter: '.formatterEnableEditCliente' }" id="inputSelecionaCodigoMaterial" placeholder="Selecionar Material" showValueHelp="true" valueHelpRequest="onInputHelpMateriaisRequest" selectedKey="" showTableSuggestionValueHelp="true" showSuggestion="true" suggestionItems="{InputHelpMateriais>/}" suggest="onSuggetsMaterial" suggestionItemSelected="onSuggestionItemSelected">
<suggestionItems>
<core:ListItem key="{InputHelpMateriais>id}" text="{InputHelpMateriais>id}" additionalText="{InputHelpMateriais>descricao} | {InputHelpMateriais>ean}"/>
</suggestionItems>
</Input>
</Toolbar>
</t:toolbar>
<t:columns>
<t:Column width="4em" hAlign="Center" resizable="false">
<t:template>
<Button icon="sap-icon://sys-cancel" type="Reject" tap="onRemoveItensTableLine"/>
</t:template>
</t:Column>
<t:Column width="4em">
<Label required="false" text="Item"/>
<t:template>
<Text text="{NovaVenda>idNum}"/>
</t:template>
</t:Column>
<t:Column width="8em">
<Label required="true" text="Material"/>
<t:template>
<Text text="{NovaVenda>idMateriais}"/>
</t:template>
</t:Column>
<t:Column width="18em">
<Label text="Material"/>
<t:template>
<Text text="{NovaVenda>sMateriais/descricao}"/>
</t:template>
</t:Column>
<t:Column width="6em">
<Label text="Unidade"/>
<t:template>
<Text text="{NovaVenda>unidade}"/>
</t:template>
</t:Column>
<t:Column width="9em" hAlign="Center">
<Label required="true" text="Quantidade"/>
<t:template>
<l:HorizontalLayout>
<Input enabled="{ path: 'NovaVenda>quantidade', formatter: '.formatterEnableItem' }" width="3em" value="{NovaVenda>quantidade}" type="Number" change="onChangeQuantidade" liveChange="onChangeCheckLength"/>
</l:HorizontalLayout>
</t:template>
</t:Column>
<t:Column width="8em" hAlign="Right">
<Label design="Bold" text="Desconto (%)"/>
<t:template>
<Input enabled="{ path: 'NovaVenda>quantidade', formatter: '.formatterEnableItem' }" value="{NovaVenda>desconto}" valueState="{ path: 'NovaVenda>descontoMaximo', formatter: '.formatterDescontoStatus' }" valueStateText="{ path: 'NovaVenda>descontoMaximo', formatter: '.formatterDescontoStatusTexto' }" type="Number" change="onChangeDesconto"/>
</t:template>
<t:menu>
<u:Menu>
<u:items>
<u:MenuItem text="Replicar primeiro produto" select="onReplicarDescontoItens"/>
</u:items>
</u:Menu>
</t:menu>
</t:Column>
<t:Column width="9em" hAlign="Right">
<Label text="Valor Unitário"/>
<t:template>
<Text text="{ parts: [{path: 'NovaVenda>valorUnitario'}, {path: 'NovaVenda>moeda'}] , type:'sap.ui.model.type.Currency' }"/>
</t:template>
</t:Column>
<t:Column width="8em" hAlign="Right">
<Label text="Valor Total"/>
<t:template>
<Text text="{ parts: [{path: 'NovaVenda>valorTotal'}, {path: 'NovaVenda>moeda'}] , type:'sap.ui.model.type.Currency' }"/>
</t:template>
</t:Column>
<t:Column width="8em" hAlign="Right">
<Label text="Condições"/>
<t:template>
<Button tap="onShowComposicaoPrecoItem" icon="sap-icon://commission-check" enabled="{ path: 'NovaVenda>valorTotal', formatter: '.formatterEnableComposicaoItemPreco' }"/>
</t:template>
</t:Column>
</t:columns>
</t:Table>
</ScrollContainer>
</content>
<footer>
<Toolbar>
<core:Fragment fragmentName="view.FooterStatus" type="XML"/>
<ToolbarSpacer/>
<Text text="Valor da Venda: "/>
<Text text="{ parts: [{path: 'NovaVenda>/valorTotal'}, {path: 'NovaVenda>/moeda'}] , type:'sap.ui.model.type.Currency' }"/>
<Button visible="{NovaVenda>/memorizado}" enabled="{ path: 'NovaVenda>/sClientes/id', formatter: '.formatterEnableEditCliente' }" tap="onFinalizarVenda" text="Finalizar venda" type="Accept"/>
</Toolbar>
</footer>
</Page>
<MessagePage visible="{ path: 'Caixa>/aberto', formatter: '.formatterCaixaFechado' }" icon="sap-icon://locked" text="É necessário abrir o caixa para acessar essa funcionalidade" description=""/>
</core:View>
